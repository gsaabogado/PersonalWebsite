---
import { getLangFromUrl, t } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);
---

<div data-animate>
  <h2 class="text-2xl font-heading font-bold text-slate-dark mb-2">
    {t(lang, "contact.formTitle")}
  </h2>
  <p class="text-charcoal/60 mb-8">
    {t(lang, "contact.formDesc")}
  </p>

  <form
    id="contact-form"
    action="https://formspree.io/f/mdalojrp"
    method="POST"
    class="space-y-5"
  >
    <!-- Name -->
    <div>
      <label for="name" class="block text-sm font-medium text-slate-dark mb-1.5">
        {t(lang, "contact.form.name")}
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        placeholder={t(lang, "contact.form.namePlaceholder")}
        class="w-full px-4 py-3 rounded-md border border-cool-gray bg-white text-charcoal placeholder-charcoal/30 focus:outline-none focus:ring-2 focus:ring-sky/30 focus:border-sky transition-colors"
      />
    </div>

    <!-- Email -->
    <div>
      <label for="email" class="block text-sm font-medium text-slate-dark mb-1.5">
        {t(lang, "contact.form.email")}
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        placeholder={t(lang, "contact.form.emailPlaceholder")}
        class="w-full px-4 py-3 rounded-md border border-cool-gray bg-white text-charcoal placeholder-charcoal/30 focus:outline-none focus:ring-2 focus:ring-sky/30 focus:border-sky transition-colors"
      />
    </div>

    <!-- Subject -->
    <div>
      <label for="subject" class="block text-sm font-medium text-slate-dark mb-1.5">
        {t(lang, "contact.form.subject")}
      </label>
      <input
        type="text"
        id="subject"
        name="subject"
        required
        placeholder={t(lang, "contact.form.subjectPlaceholder")}
        class="w-full px-4 py-3 rounded-md border border-cool-gray bg-white text-charcoal placeholder-charcoal/30 focus:outline-none focus:ring-2 focus:ring-sky/30 focus:border-sky transition-colors"
      />
    </div>

    <!-- Message -->
    <div>
      <label for="message" class="block text-sm font-medium text-slate-dark mb-1.5">
        {t(lang, "contact.form.message")}
      </label>
      <textarea
        id="message"
        name="message"
        rows="5"
        required
        placeholder={t(lang, "contact.form.messagePlaceholder")}
        class="w-full px-4 py-3 rounded-md border border-cool-gray bg-white text-charcoal placeholder-charcoal/30 focus:outline-none focus:ring-2 focus:ring-sky/30 focus:border-sky transition-colors resize-y"
      ></textarea>
    </div>

    <!-- Submit -->
    <button
      type="submit"
      class="w-full sm:w-auto px-8 py-3 bg-slate text-white font-medium rounded-md hover:bg-slate-light transition-colors"
    >
      {t(lang, "contact.form.submit")}
    </button>

    <!-- Success/Error messages -->
    <div id="form-success" class="hidden p-4 bg-green-50 text-green-700 rounded-md text-sm">
      {t(lang, "contact.form.success")}
    </div>
    <div id="form-error" class="hidden p-4 bg-red-50 text-red-700 rounded-md text-sm">
      {t(lang, "contact.form.error")}
    </div>
  </form>
</div>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const successMsg = document.getElementById("form-success");
  const errorMsg = document.getElementById("form-error");

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    successMsg?.classList.add("hidden");
    errorMsg?.classList.add("hidden");

    try {
      const response = await fetch(form.action, {
        method: "POST",
        body: new FormData(form),
        headers: { Accept: "application/json" },
      });

      if (response.ok) {
        form.reset();
        successMsg?.classList.remove("hidden");
      } else {
        errorMsg?.classList.remove("hidden");
      }
    } catch {
      errorMsg?.classList.remove("hidden");
    }
  });
</script>
